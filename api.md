# Data Model 

## Unit Types

- **`Object`**
  - `id: UUID`: A UUID representing the object.
  - `type: string`: The type of this object. _(Set automatically by subclasses.)_

- **`Unit`**: For example, a quantity with only a mass unit might be a dosage, a quantity with mass and volume units would be a concentration, and a quantity with volume and time units would be a rate (i.e. for IV infusion).
  - `mass: string|null`: The mass units of this quantity (i.e. `mg`, `mg/ml`, or `mg/kg`), if applicable.
  - `volume: string|null`: The volume units of this quantity (i.e. `ml`), if applicable. 
  - `time: string|null`: The time units of this quantity (i.e. `ml/min`), if applicable.

- **`Quantity`**: Denotes a numeric value with units (i.e. dosage). 
  - `value: number`: The amount of this quantity.
  - `unit: Unit`: The units of this quantity.

- **`Period`**: TODO
  - `start: date`
  - `end: date`
  - `limit: number`
  - `limit_unit: string<doses|days|weeks|...>`
  - `every: number`
  - `every_unit: string<hours|months|weeks|...>`

- **`MedSig`**: Represents the "sig" of a medication (dosage instructions).
  - `dose: Quantity`:
  - `frequency: Period`
  - `site: string`
  - `route: string`
  - `duration: number`
  - `prn: boolean`
  - `prn_comment: string`
  - `comment: string`

## Resource Types

- **`Facility: Object`**: A place that medical care takes place (i.e. `My Cool Hospital`).
  - `name: string`: The name of the facility.
  - `departments: Department[]`: 

- **`Department: Object`**: A subunit of a facility.
  - `facility: Facility.id`: 
  - `name: string`: 
  - `locations: Location[]`:

- **`Location: Object`**: A location within the department (i.e. a room `12` or bed `6210A`).
  - `department: Department.id`: 
  - `name: string`: 
  - `schedules: Schedule[]`: 

- **`Practitioner: Object`**: An individual providing care to patients in the facility. 
  - `facility: Facility.id`: 
  - `name: string`: 
  - `schedules: Schedule[]`: 
  - `lists: List[]`: 

- **`Patient: Object`**
  - `id: UUID`: Note: this `id` field is the same as one inherited from `Object`, and also serves as the patient's `mrn` (medical records number).
  - `name: string`: 
  - `birthdate: date`: 
  - `gender: string`: 
  - `language: string`: 
  - `address: string`: 
  - `insurance: string`: 

- **`Schedule`**
  - `department: string`
  - `period: date-temporal`: TODO.
  - `comment: string`

- **`Appointment`**
  - `patient: Patient`
  - `practitioner: Practitioner`
  - `location: Location`
  - `date: date`
  - `duration: number`
  - `status: string`
  - `flag: string`
  - `concern: string`: The reason-for-visit (RFV) or chief-complaint (CC) for the appointment.
  - `comment: string`: Any miscellaneous notes for this appointment.

- **`List`**
  - `name: string`
  - `parent: List`
  - `owner: Practitioner|null`: The owner of the list, or `null` if this is a system-wide accessible list.
  - `shared: Practitioner[]|null`: A set of Practitioners that have read-write access, or `null` if not shared.
  - `patients: Patient[]`

- **`Encounter`**
  - `appointment: Appointment|null`: The originating appointment for this encounter, if applicable (i.e. outpatient clinic setting).
  - `start: date`
  - `end: date`
  - `type: string`
  - `status: Status`
  - `department: string`
  - `care_team: <>[]`
    - `practitioner: Practitioner`
    - `role: string(pcp|ed|hospitalist|consult|student|nurse|...)`
    - `start: date`
    - `end: date`
  - `concerns: Condition[]`: This condition list acts as the ED clinical impression differential diagnosis list.
  - `diagnoses: Condition[]`: This condition list acts as the outpatient visit diagnoses list.
  - `problems: Condition[]`: This condition list acts as the inpatient active/resolved problem list.
  - `observations: Observation[]`: This acts as the equivalent of recorded observations in flowsheets.
  - `history: <>`: 
    - `allergies: <>[]`
      - `substance: string`
      - `reaction: string`
      - `type: string(allergy|intolerance|side-effect)`
      - `severity: string(low|high|unknown)`
      - `verified: boolean`
      - `resolved: boolean`
      - `recorded: date`
      - `recorder: Practitioner`
      - `comment: string`
    - `immunizations: ImmunizationHistory[]`: TODO: each visit-administered immunization (MAR entry) will ALSO need a corresponding history item.
- **`Status`**
  - `value: string`: The status.
  - `changed: date`: When this status was applied.
  - `actor: Practitioner`: The Practitioner that applied this status.
- **`Condition`**
  - `code: string`: The SNOMED-CT code mapped to the condition.
  - `title: string`: The human-friendly renamed title of the condition.
  - `principal: boolean`
  - `active: boolean`
  - `hospital: boolean`
  - `priority: number`
  - `recorded: date`
  - `recorder: Practitioner`
  - `comment: string`
- **`Observation`**
  - `code: string`: The code mapped to this observation (i.e. `pulse`, `systolic-bp`, etc.).
  - `value: string`: The value of the observation.
- **`Result`**:
  - `code: string`: The LOINC code mapped to this result.
  - `date: date`
  - `status: string`
  - `components: Component[]`
  - `image: string|null`: A base64-encoded data-uri OR an external URL containing DICOM imaging data for this result, if applicable, otherwise `null`.
  - Examples:
    - `EKG={"11524-6", ..., "over-read", [{"RPT", "EKG report here"}], "data:image/dcm;base64,aGVsbG8="}`
- **`Component`**
  - `name: string`: The name of the sub-component of this result (i.e. `NA`, `TSH`, or `RPT`/`NARR`/`IMP` for imaging report).
  - `value: string|number`: The value of the sub-component.
  - `low: number|null`: The inclusive low end of the normal range for this component, or `null` if not applicable.
  - `high: number|null`: The inclusive high end of the normal range for this component, or `null` if not applicable.
  - `comment: string|null`: An optional comment about the component.
- **`Order`**
  - `created: date`
  - `creator: Practitioner`
  - `status: string`
- **`Note`**
  - `encounter: Encounter`
  - `author: Practitioner`
  - `cosigner: Practitioner[]|null`: A set of cosigners for the note, or `null` if not applicable for co-signing. An empty set indicates this note still requires co-sign before it is approved. Co-signing the note will create an addended version.
  - `created_date: date`: The date the note was actually created.
  - `service_date: date`: The service date for which the note contains information (which may be earlier, but never later than the `created_date`).
  - `type: string(hp|progress|discharge|consult|staff)`
  - `status: string(pended|signed|sign-with-visit|addended)`
  - `replaced_by: Note|null`: If this note has been `status=addended`, this **MUST** point to the replacing note, otherwise it is `null`.
  - `content: string`
- **`Medication`**
  - `id: string`
  - `name: string`: The generic name of the medication.
  - `brandName: string`: The brand name of the medication.
  - `dose: number`: The prescribed dosage.
  - `unit: string`: The measurement unit (e.g., mg, mL).
  - `frequency: string`: How often the medication should be taken.
  - `startDate: date|null`: The date the medication was started.
  - `endDate: date|null`: The date the medication was discontinued, or null if ongoing.
  - `route: string`: The method of administration (e.g., Oral, IV).
  - `possiblePrnReasons: string[]`: List of potential reasons for taking this medication as needed.
  - `activePrnReasons: string[]`: List of active reasons for PRN (as needed) use.
- **`LabTest`**
  - `dateTime: date` – The date and time of the test.
  - `test: string` – The name of the test performed.
  - `status: string` – The current status of the test (e.g., completed, pending).
  - `abnormal: boolean` – Whether the test result is flagged as abnormal.
  - `expectedDate: date|null` – The expected date for results.
  - `expiration: date|null` – The expiration date of the test result.
  - `encounterProvider: Practitioner` – The provider who ordered the test.
  - `labResults: LabResult[]` – A list of results from this test.
- **`LabResult`**
  - `name: string` – The name of the test component.
  - `low: number|null` – The lower reference range, or `null` if not applicable.
  - `high: number|null` – The upper reference range, or `null` if not applicable.
  - `units: string|null` – The unit of measurement.
  - `value: string|number` – The recorded value.
  - `comment: string|null` – Additional comments on the result.
- **`FamilyHistory`**
  - `relationship: string` – The relationship to the patient (e.g., mother, father).
  - `name: string` – The name of the family member, if recorded.
  - `status: string` – The family member's health status (e.g., alive, deceased).
  - `age: number` – The family member’s age.
  - `problems: Condition[]` – A list of `Condition` affecting the family member.
- **`ImmunizationHistory`**: This documents **historical** immunizations only (i.e. those that were not ordered and administered as part of an encounter). TODO: This needs to be merged or aligned in some capacity with `MedicationAdministration`.
  - `name: string` – The name of the immunization. This should match the `Medication` order name for the same immunization.
  - `date: date` – The approximate date/time that this immunization was administered to the patient.
  - `given_by: Practitioner|null` – The practitioner that administered this immunization.
  - `facility: string|null` – The facility that administered this immunization.
  - `dose: Quantity`: The infusion rate (if IV GTT) or quantity (if IV push or PO, etc.) and units (i.e. `mg/ml` or `mg`).
  - `site: string|null` – The site of administration. (See `MedicationAdministration`).
  - `route: string|null` - The route of administration. (See `MedicationAdministration`).
  - `lot: string|null` – The lot number for the immunization.
  - `manufacturer: string|null` – The manufacturer for the immunization.
- **`MedicationAdministration`**
  - `order: Order.id`: The original order that this medication administration entry corresponds to.
  - `medication: Medication.id`: The medication that this medication administration entry corresponds to. This should be identical to `order.medication`.
  - `taken: Date`: The date/time that this medication administration entry occurred.
  - `performed_by: Practitioner`: The practitioner that performed this action.
  - `documented_by: Practitioner`: The practitioner that documented this action.
  - `action: string<Given | Missed | Refused | Canceled Entry | Held | New Bag | Restarted | Stopped | Rate Change | MAR Hold | MAR Unhold | Bolus | Push | Rate Verify | See Alternative | Paused | Prepared | Pending | Automatically Held | Due>`
  - `dose: Quantity`: The infusion rate (if IV GTT) or quantity (if IV push or PO, etc.) and units (i.e. `mg/ml` or `mg`).
  - `route: string`: See [SNOMED CT route codes](https://build.fhir.org/valueset-route-codes.html) and [method codes](https://build.fhir.org/valueset-administration-method-codes.html).
  - `site: string`: The site location that this medication was administered.
  - `duration: number`: The length of time this administration took, in seconds.
